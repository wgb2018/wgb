<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.microdev.mapper.NoticeMapper">
    <sql id="Notice_Column_List">
        id as pid, create_time, deleted, modify_time, need_workers, from_date, to_date, content, hotel_id
    </sql>
    <select id="queryList" resultType="com.microdev.model.Notice" parameterType="com.microdev.param.QueryNoticeRequest">
        select distinct n.id as pid,n.create_time as createTime, n.deleted, n.modify_time as modifyTime, n.need_workers as needworkers, n.from_date as fromDate, n.to_date as toDate, n.content, n.hotel_id as hotelId
        from notice n left join notice_service s on n.id = s.notice_id left join company c on n.hotel_id = c.id
        <where>
            <if test="date != null">
                !(n.from_date &gt;= #{toDate} || n.to_date &lt;= #{fromDate})
            </if>
            <if test="hotelName != null and hotelName !=''">
                and c.name like concat('%', #{hotelName},'%')
            </if>
            <if test="service != null and service != ''">
                and s.service_id = #{service}
            </if>
            <if test="hotelId != null and hotelId != ''">
                and c.id = #{hotelId}
            </if>
            <if test="hrId != null and hrId != ''">
                and c.bind_companys = 1 or c.id in (select hotel_id from hotel_hr_company where hr_id = #{hrId} and status in (0,5))
            </if>
        </where>
        order by n.create_time desc
    </select>
</mapper>